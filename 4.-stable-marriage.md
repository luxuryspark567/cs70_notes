# 4. Stable Marriage

## Some quibbles.

The induction principle works on the natural numbers.

* Proves statements of form: $$\forall n \in N, P(n)$$.
* What if the statement is only for n ≥3?
  * $$\forall n \in N, (n \geq  3) \implies P(n)$$, Restate as: $$∀n ∈N, Q(n) \, where \, Q(n) =“(n ≥3) ⇒P(n)”$$.
  * Base Case: typically start at 3. Since $$\forall n \in N, Q(n) \implies Q(n + 1)$$ is trivially true before 3.
* <mark style="color:$info;">Any set where any subset of the set has a smallest element</mark>.

## Strong Induction and Recursion.

**Thm:** For every natural number $$n \geq 12, n = 4x + 5y$$.

Instead of proof, let’s write some code!

```
def find-x-y(n):
    if (n==12) return (3,0)
    elif (n==13): return(2,1)
    elif (n==14): return(1,2)
    elif (n==15): return(0,3)
else:
    (x’,y’) = find-x-y(n-4)
    return(x’+1,y’)
```

* Base cases: P(12) , P(13) , P(14) , P(15).
* Strong Induction Step:&#x20;
  * Recursive call is correct: P(n−4) ⇒ P(n).
  * n−4= 4x′+ 5y′ ⇒ n = 4(x′+ 1) + 5(y′)

Slight differences:&#x20;

* For all n ≥16 that $$∧_{i=4}^{n−1} P(i) \implies P(n)$$.

## Strengthening:

{% hint style="warning" %}
In the next slides, I can just tell you the proof, but the problem is how you come up with the proof. Now the answer is I dont know. So there are viriaty of ways to do this. When I tell you about the proof, it is necessarily vage. I will just show you maybe someone would struggle with this.
{% endhint %}

Theorem: For all n ≥1, $$\sum_{i=1}^{n} \frac {1} {i^2} \leq 2$$. ($$S_n = \sum_{i=1}^{n} \frac {1} {i^2}$$)

* Base: $$P(1): 1 \leq 2$$.
* Hypothys: $$\sum_{i=1}^{k} \frac {1} {i^2} \leq 2$$
* Ind Step:&#x20;
  * $$\sum_{i=1}^{k+1} \frac {1} {i^2}$$$$=\sum_{i=1}^{k} \frac {1} {i^2} + \frac{1}{(k+1)^2}$$$$\leq 2+ \frac{1}{(k+1)^2}$$

<mark style="color:$danger;">2 adding a positive number can't be smaller than 2</mark>. It better be that any sum is strictly less than 2.

How much less? At least by $$\frac {1}{(k+1)^2}$$for $$S_k$$

$$S_k \leq 2 - \frac {1}{(k+1)^2} \implies S_{k+1} \leq 2$$

Induction step works? <mark style="color:$danger;">No.</mark>

* Not the same statement, the Hypothys need to be proved.
* Need to prove $$S_{k+1} \leq 2 - \frac {1}{(k+2)^2}$$

## How to Strenthen

Theorem: For all n ≥1, $$\sum_{i=1}^{n} \frac {1} {i^2} \leq 2-f(n)$$. ($$S_n = \sum_{i=1}^{n} \frac {1} {i^2}$$)

**Proof**:

* Ind hyp: $$P(k ) : S_k ≤2−f (k )$$
* Prove: $$P(k + 1) : S_{k +1} ≤2−f (k + 1)$$
  * $$S_{k +1} = S_k + \frac {1}{(k+1)^2} \leq 2 - f(k) + \frac {1}{(k+1)^2}$$ By ind. hyp.

Choose a $$f(k)$$ , which meets: $$f(k+1) \leq f(k) - \frac {1}{(k+1)^2} \implies S(k+1) \leq 2-f(k+1)$$

<mark style="color:$warning;">Subtracting off a quadratically decreasing function every time. Maybe a linearly decreasing function to keep positive?</mark>

<mark style="color:$warning;">Try</mark> $$f(k) = \frac {1}{k}$$.

* $$\frac {1}{k+1} \leq \frac{1}{k} - \frac {1}{(k+1)^2}$$?
  * $$1 \leq \frac{k+1}{k} - \frac{1}{k+1}$$, Multiplied by k+1
  * $$1 \leq 1 +(\frac{1}{k} - \frac{1}{k+1})$$, <mark style="color:$success;">which is true.</mark>

Theorem: For all n ≥1, $$\sum_{i=1}^{n} \frac {1} {i^2} \leq 2-\frac{1}{n}$$

## Stable Marriage Problem

* Small town with n boys and n girls.
* Each girl has <mark style="color:$info;">a ranked preference list</mark> of boys.
* Each boy has <mark style="color:$info;">a ranked preference list</mark> of girls.

<mark style="color:$warning;">How should they be matched?</mark>

Consider the couples..

* Jennifer and Brad
* Angelina and Billy-Bob

Brad and Angelina will get together when they had the chance.

* Brad prefers Angelina to Jennifer.
* Angelina prefers Brad to BillyBob.

## Produce a pairing where there is no running off!

**Definition**: <mark style="color:$info;">A</mark> <mark style="color:$info;"></mark><mark style="color:$info;">**pairing**</mark> <mark style="color:$info;"></mark><mark style="color:$info;">is disjoint set of n boy-girl pairs</mark>.

* Example: A pairing S= {(Brad , Jen); (BillyBob, Angelina)}.

<mark style="color:$warning;">**Definition**</mark><mark style="color:$warning;">: A</mark> <mark style="color:$warning;"></mark><mark style="color:$warning;">**rogue couple**</mark> <mark style="color:$warning;"></mark><mark style="color:$warning;">(b, g∗)for a pairing S: b and g∗ prefer each other to their partners in S.</mark>

* Example: Brad and Angelina are a rogue couple in S.

## A Stable Pairing

Given a set of preferences.

* Is there a stable pairing?
* How does one find it?

Consider a single gender version: stable roommates.

<figure><img src=".gitbook/assets/image (20).png" alt="" width="146"><figcaption></figcaption></figure>

* {(A, B), (C, D)}
  * B prefers C than A, and C prefers B than D, rouge couple (B, C);
* {(A, D), (B, C)}
  * C prefers A than B, and A prefers C than D, rouge couple (A, C);
* {(A, C), (B, D)}
  * A prefers B than C, and B prefers A than D, rouge couple (A, B);
* {(A, B), (C, D)}
  * running into a loop;

No stable result for this one.

## The Traditional Marriage Algorithm.

Each Day:

1. <mark style="color:blue;">Each boy</mark> <mark style="color:blue;"></mark><mark style="color:blue;">**proposes**</mark> <mark style="color:blue;"></mark><mark style="color:blue;">to his favorite girl on his list.</mark>
2. <mark style="color:blue;">Each girl rejects all but her favorite proposer (whom she puts on a string.)</mark>
3. <mark style="color:blue;">Rejected boy crosses rejecting girl off his list.</mark>

Stop when each girl gets exactly one proposal.

<figure><img src=".gitbook/assets/image (18).png" alt=""><figcaption></figcaption></figure>

## Termination.

<mark style="color:$info;">Every non-terminated day a boy crossed an item off the list</mark>.

Total size of lists? n boys, n length list. $$n^2$$

Terminates in at most $$n^2 + 1$$ steps!

## It gets better every day for girls..

<mark style="color:$warning;">**Improvement Lemma**</mark>: **It just gets better for girls**.

If on day $$t$$ a girl $$g$$ has a boy $$b$$ on a string,

any boy, $$b^′$$, on $$g$$'s string for any day $$t^′> t$$ is at least as good as b.

Let’s apply lemma.

* Girl “Alice” has boy “Bob” on string on day 5.
* She has boy “Jim” on string on day 7.
* Does Alice prefer “Jim” or “Bob”?

g - ’Alice’, b - ’Bob’, b′- ’Jim’, t= 5, t′ = 7.

<mark style="color:$success;">Improvement Lemma says she prefers ’Jim’.</mark>

On day 10, could Alice still have “Jim” on her string? Yes.

She likes her day 10 boy at least as much as her day 7 boy.

Here, b= b′.

Why is lemma true?

<mark style="color:$danger;">Proof Idea:</mark> <mark style="color:$danger;"></mark><mark style="color:$danger;">**Because she can always keep the previous boy on the string**</mark><mark style="color:$danger;">.</mark>

## Improvement Lemma

**Improvement Lemma: It just gets better for girls.**

If on day $$t$$ a girl $$g$$ has a boy $$b$$ on a string, any boy, $$b^′$$, on $$g$$’s string for any day $$t^′> t$$ is at least as good as $$b$$.

**Proof:**

* **Thm:** $$P(k)$$: “boy on $$g$$’s string is at least as good as $$b$$ on day $$t + k$$”
* **Base Case**: $$P(0)$$– true. Girl has $$b$$ on string on day $$t$$ .
* **Assumption**: Assume $$P(k)$$.&#x20;
* **Induction:**
  * Let $$b^′$$ be boy on string on day $$t + k$$.
  * On day $$t + k + 1$$, boy $$b^′$$ comes back.
  * Girl can choose $$b^′$$, or do better with another boy, $$b^{′′}$$. That is, $$b^′≤b$$ <mark style="color:$danger;">by induction hypothesis</mark>. And $$b^{′′}$$ is better than $$b^′$$ <mark style="color:$danger;">**by algorithm (if**</mark> $$b^{′′}$$ is choosed, then  $$b^{′′}$$ must be better than  $$b^′$$, becuase <mark style="color:$danger;">**she crosses out only boys who are worse)**</mark>.⇒ Girl does at least as well as with $$b$$ .
  * $$P(k)  ⇒ P(k + 1)$$. And by principle of induction.

## Pairing when done.

**Lemma**: Every boy is matched at end.

**Proof**:

* If not, <mark style="color:$danger;">a boy b must have been rejected n times</mark>.
* Every girl has been proposed to by b, and Improvement lemma ⇒ each girl has a boy on a string. and each boy is on at most one string.
* n girls and n boys. Same number of each.
* <mark style="color:$danger;">⇒ b must be on some girl’s string!</mark>
* <mark style="color:$danger;">Contradiction.</mark>

## Pairing is Stable.

**Lemma**: There is no rogue couple for the pairing formed by traditional marriage algorithm.

**Proof**:

* Assume there is a rogue couple; (b, g∗)

<figure><img src=".gitbook/assets/image (19).png" alt=""><figcaption></figcaption></figure>

* Boy b proposes to g∗before proposing to g. So g∗rejected b (since he moved on)
* By improvement lemma, <mark style="color:$danger;">g∗likes b∗better than b</mark>. <mark style="color:$danger;">Contradiction!</mark>

{% hint style="success" %}
<mark style="color:$info;">What we assume: There is a rouge couple.</mark>&#x20;

<mark style="color:$info;">What we get: There is a contradiction.</mark>&#x20;

<mark style="color:$info;">What we know: There is no rouge couple.</mark>&#x20;

<mark style="color:$info;">So what it means: It is a stable pairing.</mark>
{% endhint %}

## Good for boys? girls?

Is the TMA better for boys? for girls?

* **Definition**: A pairing is **x-optimal** if x′s partner is x’s best partner in any stable pairing.
* **Definition**: A pairing is **x-pessimal** if x′s partner is x’s worst partner in any stable pairing.
* **Definition**: A pairing is boy optimal if it is x-optimal for all boys x.

..and so on for boy pessimal, girl optimal, girl pessimal.

<mark style="color:$danger;">Claim: Optimal partner for a boy must be first in his preference list.</mark>

* True? False? False!

Subtlety here: Best partner in any <mark style="color:$danger;">stable</mark> pairing. As well as you can be in a globally stable solution!

<mark style="color:$info;">Question: Is there a boy or girl optimal pairing?</mark>

Is it possible: b-optimal pairing different from the b′-optimal pairing!

Yes? No?

## Understanding Optimality: by example.

<figure><img src=".gitbook/assets/image (21).png" alt=""><figcaption></figcaption></figure>

Consider pairing: (A, 1), (B, 2).

* Stable? Yes.
* Optimal for B?
  * Notice: only one stable pairing.
  * So this is the best B can do in a stable pairing.
  * So optimal for B.

Also optimal for A, 1 and 2. Also pessimal for A,B,1 and 2.

<figure><img src=".gitbook/assets/image (22).png" alt=""><figcaption></figcaption></figure>

* Pairing S: (A, 1), (B, 2). Stable? Yes.
* Pairing T : (A, 2), (B, 1). Also Stable.
* Which is optimal for A? S Which is optimal for B? S
* Which is optimal for 1? T Which is optimal for 2? T

## TMA is optimal for one gender!

For boys? For girls?

**Theorem: TMA produces a&#x20;**<mark style="color:$danger;">**boy-optimal pairing**</mark>**.**

**Proof**:

* **Assume not**: (by the definition of boy-optimal)
  * Some boy $$b$$ not paired with optimal girl, $$g$$ in TMA pairing $$T$$.
  * <mark style="color:red;">There is a stable pairing</mark> $$S$$ <mark style="color:red;">where</mark> $$b$$ <mark style="color:red;">and</mark> $$g$$ <mark style="color:red;">are paired</mark>. (because TMA pairing $$T$$ is not boy optimal)

Let $$t$$ be first day a boy $$b$$ gets rejected (Well ordering priciple to look on day $$t$$)

&#x20;   by his optimal girl $$g$$ who he is paired with&#x20;

&#x20;   in stable pairing $$S$$.

(Above are all the situations)

$$b^′$$- knocks $$b$$ off of $$g$$’s string on day $$t$$ ⇒ $$g$$ <mark style="color:red;">prefers</mark> $$b^′$$ <mark style="color:red;">to</mark> $$b$$

By choice of $$t$$, $$b^′$$ prefers $$g$$ to his optimal girl. (<mark style="color:$danger;">By well ordering principle,</mark> $$b^′$$ <mark style="color:$danger;">has not been rejected by his optimal girl yet</mark>)

<mark style="color:$danger;">⇒</mark> $$b^′$$ <mark style="color:red;">prefers</mark> $$g$$ <mark style="color:red;">to his partner</mark> $$g^′$$ <mark style="color:red;">in</mark> $$S$$<mark style="color:$danger;">. (Because every boy have a prefer list, if he ask g before</mark> $$g^′$$, then $$b^′$$ must prefer g to $$g^′$$<mark style="color:$danger;">)</mark>

<mark style="color:red;">Rogue couple</mark> $$(b^′, g)$$ <mark style="color:red;">for</mark> $$S$$<mark style="color:red;">.</mark>

<mark style="color:orange;">**So S is not a stable pairing. Contradiction.**</mark>

Notes: S - stable. $$(b^′, g^′)$$and $$(b, g) ∈S$$. But $$(b^′, g)$$ is rogue couple!

Used Well-Ordering principle...Induction.

{% hint style="success" %}
Why g likes $$b^′$$ than $$b$$, because $$b^′$$ knocks $$b$$ off the string of $$g$$.&#x20;

Why $$b^′$$ likes like $$g$$ than $$g^′$$, because $$b^′$$ hasn't been rejected by his optimal girl, then $$g$$ is at least as good as his optimal girl $$g^′$$
{% endhint %}

## How about for girls?

**Theorem: TMA** produces girl-pessimal pairing.

**Assume not**:

* T – pairing produced by TMA. (And assume T is not girl-pressimal)
* <mark style="color:$danger;">S</mark> – worse <mark style="color:$danger;">stable pairing</mark> for girl g.

In T, (g, b) is pair.

In S, (g, b^′) is pair.

<mark style="color:red;">g likes b^′ less than she likes b, because S is worse than T for g</mark>

T is boy optimal, so <mark style="color:red;">b likes g more than his partner g</mark>^{′′}<mark style="color:red;">in S</mark><mark style="color:$info;">.</mark>

<mark style="color:orange;">(g,</mark> b^′<mark style="color:orange;">) is Rogue couple for S (g likes b and b likes g)</mark>

<mark style="color:$danger;">S is not stable. Then there is no worse pairing for girl, it means that T is girl-pessimal.</mark>

<mark style="color:red;">Contradiction.</mark>

Notes: Not really induction.

Structural statement: Boy optimality⇒ Girl pessimality.

## Quick Questions.

How does one make it better for girls?

* SMA - stable marriage algorithm. One side proposes.
* TMA - boys propose.
* Girls could propose.⇒ optimal for girls.

## Residency Matching..

The method was used to match residents to hospitals.

Hospital optimal....

..until 1990’s...Resident optimal.

Another variation: couples.
